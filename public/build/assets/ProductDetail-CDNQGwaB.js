import{j as _,r as f,p as Q,y as ee,c as te,w as L,g as r,i as w,d as n,o as l,a as A,b as e,h as oe,F as B,s as E,n as se,t as d,k as ae,m as ne,x as I,l as le,f as ie,e as re,A as ce}from"./app-Ct_mwAxD.js";import{S as de}from"./SiteLayout-DEC0OJpP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ue={key:0},me={class:"mx-auto max-w-7xl p-6 pt-[100px]"},he={class:"grid gap-6 md:grid-cols-2"},ve=["src"],ge={class:"mt-3 flex justify-center gap-2"},fe=["src","alt","onClick"],pe={key:0,class:"mt-3 flex justify-between"},xe={class:"text-2xl font-semibold dark:text-cream"},be={class:"mt-1 text-gray-500"},_e={class:"mt-3 text-xl font-bold text-brown dark:text-cream"},we={class:"mt-2 leading-relaxed text-brown dark:text-offwhite"},ye={class:"mt-2 text-sm"},ke={key:0,class:"inline-flex items-center rounded-full bg-green-100 px-3 py-1 font-medium text-green-700"},Se={key:1,class:"inline-flex items-center rounded-full bg-rose-100 px-3 py-1 font-medium text-rose-700"},Ce={class:"mt-4 flex items-center gap-3"},Ne={class:"inline-flex items-center rounded border"},De=["disabled"],Me=["min","max","disabled"],je=["disabled"],Pe=["disabled"],Te=["disabled"],ze={key:0,class:"mt-12"},$e={class:"xs:grid-cols-2 mt-4 grid gap-6 sm:grid-cols-3 lg:grid-cols-4"},qe=["onClick"],Le={class:"bg-gray-50 p-6"},Ae=["src","alt"],Be={class:"p-4"},Ee={class:"mt-1 text-sm text-gray-600"},Ie={class:"mt-1 font-semibold"},Re={key:0,class:"pointer-events-none absolute left-3 top-3 z-20"},Fe={class:"rounded bg-black/70 px-2 py-0.5 text-[10px] font-medium text-white"},Oe={key:1,class:"p-10 text-center text-gray-500"},Ve=["src"],Ze={__name:"ProductDetail",props:{product:{type:Object,default:null},related:{type:Array,default:()=>[]}},setup(R){const N=R,a=N.product||{},y=N.related||[],F=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(t||0)),D=(t,o=a?.id)=>t?.url||`/theme/images/p${Number(o)%8||1}.png`,M=t=>{const o=t?.category;return o?o?.parent?.name?`${o.parent.name} → ${o.name}`:o.name:""},u=_(()=>{const t=Array.isArray(a.images)?a.images:[];return t.length?t:[{url:`/theme/images/p${Number(a?.id)%8||1}.png`}]}),m=f(0),j=_(()=>D(u.value[m.value],a?.id));function O(t){t>=0&&t<u.value.length&&(m.value=t)}function V(){m.value=(m.value-1+u.value.length)%u.value.length}function X(){m.value=(m.value+1)%u.value.length}const h=_(()=>Number(a?.stock??0)),i=_(()=>h.value>0),c=f(i.value?1:0);function U(){if(!i.value){c.value=0;return}c.value=Math.max(1,Math.min(c.value||1,h.value))}function W(){i.value&&(c.value=Math.max(1,(c.value||1)-1))}function Y(){i.value&&(c.value=Math.min(h.value,(c.value||1)+1))}async function P(t=!1){if(!i.value){window.Swal?.fire({icon:"warning",title:"Stok habis",text:"Maaf, stok produk ini kosong."});return}const o=await fetch("/cart/items",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")},credentials:"same-origin",body:JSON.stringify({product_id:a.id,qty:c.value})});if(o.ok){t?I.visit(route("cart.index")):window.Swal?.fire({toast:!0,position:"top-end",icon:"success",title:"Ditambahkan ke cart",timer:1400,showConfirmButton:!1});return}let s=null;try{s=await o.json()}catch{}o.status===401?window.location.href=route("login"):o.status===419?window.Swal?.fire({icon:"warning",title:"Sesi kedaluwarsa",text:"Silakan muat ulang halaman."}).then(()=>window.location.reload()):o.status===422&&s?.error==="qty_exceeds_stock"?window.Swal?.fire({icon:"warning",title:"Stok tidak cukup",html:s?.message||"Jumlah melebihi stok."}):window.Swal?.fire({icon:"error",title:"Gagal menambah",text:s?.message||"Terjadi kesalahan."})}function Z(){P(!1)}function H(){P(!0)}const T=t=>route("product.show",t.slug??t.id),J=t=>I.visit(T(t)),k=f(!1),p=f(1),v=f({x:0,y:0});let x=!1,S={x:0,y:0},C={x:0,y:0};function G(){k.value=!0,p.value=1,v.value={x:0,y:0}}function z(){k.value=!1}function K(t){t.preventDefault();const o=Math.min(4,Math.max(1,p.value+(t.deltaY<0?.1:-.1)));p.value=Number(o.toFixed(2))}function $(t){x=!0;const o=t.touches?.[0]??t;S={x:o.clientX,y:o.clientY},C={...v.value}}function q(t){if(!x)return;const o=t.touches?.[0]??t;v.value={x:C.x+(o.clientX-S.x),y:C.y+(o.clientY-S.y)}}function b(){x=!1}return Q(()=>{window.addEventListener("mouseup",b),window.addEventListener("touchend",b)}),ee(()=>{window.removeEventListener("mouseup",b),window.removeEventListener("touchend",b)}),(t,o)=>(l(),te(de,null,{default:L(()=>[n(a)&&n(a).id?(l(),r("div",ue,[A(n(oe),{title:n(a).name||"Product Detail"},null,8,["title"]),e("section",me,[e("div",he,[e("div",null,[e("img",{src:j.value,alt:"Product",class:"aspect-square w-full cursor-zoom-in rounded-lg border object-cover",onClick:G},null,8,ve),e("div",ge,[(l(!0),r(B,null,E(u.value,(s,g)=>(l(),r("img",{key:g,src:s.url,alt:"thumb-"+g,onClick:Xe=>O(g),class:se(["h-16 w-16 cursor-pointer rounded border object-cover",{"ring-2 ring-indigo-500":m.value===g}])},null,10,fe))),128))]),u.value.length>1?(l(),r("div",pe,[e("button",{class:"rounded border px-3 py-1",onClick:V}," ‹ Prev "),e("button",{class:"rounded border px-3 py-1",onClick:X}," Next › ")])):w("",!0)]),e("div",null,[e("h1",xe,d(n(a).name),1),e("p",be,d(M(n(a))),1),e("p",_e,d(F(n(a).price)),1),e("p",we,d(n(a).description),1),e("p",ye,[i.value?(l(),r("span",ke," Stok: "+d(h.value),1)):(l(),r("span",Se," Stok habis "))]),e("div",Ce,[e("div",Ne,[e("button",{class:"px-3 py-2",onClick:W,disabled:!i.value}," - ",8,De),ae(e("input",{class:"w-14 border-x px-2 py-2 text-center bg-white dark:bg-brown focus:outline-none",type:"number","onUpdate:modelValue":o[0]||(o[0]=s=>c.value=s),onInput:U,min:i.value?1:0,max:h.value,disabled:!i.value},null,40,Me),[[ne,c.value,void 0,{number:!0}]]),e("button",{class:"px-3 py-2",onClick:Y,disabled:!i.value}," + ",8,je)]),e("button",{class:"rounded bg-sage border px-4 py-2 text-white hover:bg-sage/70 disabled:opacity-50",onClick:Z,disabled:!i.value}," Add to Cart ",8,Pe),e("button",{class:"rounded bg-brown px-4 py-2 text-white hover:bg-brown/70 disabled:opacity-50",onClick:H,disabled:!i.value}," Buy Now ",8,Te)])])]),n(y)&&n(y).length?(l(),r("section",ze,[o[1]||(o[1]=e("h2",{class:"text-lg font-semibold text-brown dark:text-cream"},"Related Products",-1)),e("div",$e,[(l(!0),r(B,null,E(n(y),s=>(l(),r("div",{key:s.id,class:"group relative overflow-hidden rounded-xl border border-sage/40 bg-cream/30 dark:bg-darkbrown/40 shadow-sm hover:shadow-md transition",onClick:g=>J(s)},[e("div",Le,[e("img",{src:D(s.images?.[0],s.id),alt:s.name,class:"aspect-square w-full object-contain bg-offwhite/70 dark:bg-gray-800"},null,8,Ae)]),e("div",Be,[A(n(le),{href:T(s),class:"relative z-20 font-medium hover:underline"},{default:L(()=>[ie(d(s.name),1)]),_:2},1032,["href"]),e("p",Ee,d(M(s)),1),e("p",Ie," Rp "+d((s.price||0).toLocaleString("id-ID")),1)]),s.images?.length>1?(l(),r("div",Re,[e("span",Fe,d(s.images.length)+" fotos ",1)])):w("",!0)],8,qe))),128))])])):w("",!0)])])):(l(),r("div",Oe," Produk tidak ditemukan. ")),k.value?(l(),r("div",{key:2,class:"fixed inset-0 z-[999] flex items-center justify-center bg-black/80 p-4",onClick:re(z,["self"])},[e("button",{class:"absolute right-4 top-4 rounded bg-white/10 px-3 py-1 text-white hover:bg-white/20",onClick:z}," ✕ Close "),e("img",{src:j.value,alt:"Zoomed",class:"max-h-[90vh] max-w-[90vw] cursor-grab select-none active:cursor-grabbing",style:ce({transform:`translate(${v.value.x}px, ${v.value.y}px) scale(${p.value})`,transition:n(x)?"none":"transform 120ms ease-out"}),onWheelPassive:K,onMousedown:$,onMousemove:q,onTouchstartPassive:$,onTouchmovePassive:q},null,44,Ve)])):w("",!0)]),_:1}))}};export{Ze as default};
